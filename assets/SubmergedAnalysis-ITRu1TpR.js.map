{"version":3,"file":"SubmergedAnalysis-ITRu1TpR.js","sources":["../../src/views/SceneEffects/SubmergedAnalysis.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { ContentWrap } from '@/components/ContentWrap'\r\nimport CesiumComponent from '@/components/Cesium/Cesium.component.vue'\r\nimport { useCesium } from '@/hooks/web/useCesium'\r\nimport { ElLink, ElButton } from 'element-plus'\r\nimport * as Cesium from 'cesium'\r\n\r\nimport CesiumDraw from '@/components/Cesium/CesiumDraw'\r\n\r\nconst { mapRegister, mapMethods } = useCesium()\r\n\r\nconst { getMap } = mapMethods\r\n\r\ndefineOptions({\r\n  name: 'SubmergedAnalysis'\r\n})\r\n\r\nlet cesiumDraw\r\nconst cesiumLoadCB = async (viewer) => {\r\n  let tileset = await Cesium.Cesium3DTileset.fromUrl('src/assets/file/保利b3dm/tileset.json', {\r\n    skipLevelOfDetail: true,\r\n    baseScreenSpaceError: 1024,\r\n    skipScreenSpaceErrorFactor: 16,\r\n    skipLevels: 2,\r\n    immediatelyLoadDesiredLevelOfDetail: false,\r\n    loadSiblings: false,\r\n    cullWithChildrenBounds: true\r\n  })\r\n  viewer.scene.primitives.add(tileset)\r\n  viewer.zoomTo(tileset)\r\n  viewer.scene.globe.translucency.enabled = true\r\n  // viewer.scene.globe.depthTestAgainstTerrain = true\r\n\r\n  //根据地形设置调整高度\r\n  let height = -65 //设置高度调整参数\r\n  var cartographic = Cesium.Cartographic.fromCartesian(tileset.boundingSphere.center)\r\n  var surface = Cesium.Cartesian3.fromRadians(\r\n    cartographic.longitude,\r\n    cartographic.latitude,\r\n    cartographic.height\r\n  )\r\n  var offset = Cesium.Cartesian3.fromRadians(\r\n    cartographic.longitude,\r\n    cartographic.latitude,\r\n    cartographic.height + height\r\n  )\r\n  var translation = Cesium.Cartesian3.subtract(offset, surface, new Cesium.Cartesian3())\r\n  tileset.modelMatrix = Cesium.Matrix4.fromTranslation(translation)\r\n\r\n  let targetHeight = 100,\r\n    speed = 0.1,\r\n    waterHeight = 10\r\n  cesiumDraw = new CesiumDraw(viewer)\r\n  cesiumDraw.drawPolygonGraphics({\r\n    height: 1,\r\n    callback: (polygon, polygonObj) => {\r\n      if (viewer.scene.globe.depthTestAgainstTerrain) {\r\n        alert('请开启深度检测')\r\n        return false\r\n      }\r\n      if (polygonObj) {\r\n        polygonObj.polygon.perPositionHeight = true\r\n        polygonObj.polygon.extrudedHeight = new Cesium.CallbackProperty(() => {\r\n          waterHeight = waterHeight + speed\r\n          if (waterHeight > targetHeight) {\r\n            waterHeight = targetHeight\r\n          }\r\n          return waterHeight\r\n        }, false)\r\n        polygonObj.polygon.material = 'src/assets/image/water.jpg'\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nconst clear = () => {\r\n  cesiumDraw.drawLayer.entities.removeAll()\r\n}\r\n</script>\r\n\r\n<template>\r\n  <ContentWrap title=\"淹没分析\">\r\n    <ElButton type=\"primary\" @click=\"clear\">清除</ElButton>\r\n    <div class=\"w-[100%] h-[100%]\">\r\n      <cesium-component\r\n        @register=\"mapRegister\"\r\n        :config=\"{\r\n          // homeButton: true\r\n        }\"\r\n        tiandituTk=\"80cd3c8ae46ae32fa0ac19f6d739d310\"\r\n        :cesiumLoadCB=\"cesiumLoadCB\"\r\n      />\r\n    </div>\r\n  </ContentWrap>\r\n</template>\r\n"],"names":["mapRegister","mapMethods","useCesium","cesiumDraw","cesiumLoadCB","viewer","__async","tileset","height","cartographic","surface","offset","translation","targetHeight","speed","waterHeight","CesiumDraw","polygon","polygonObj","clear"],"mappings":"gxBASA,KAAA,CAAA,YAAAA,EAAA,WAAAC,CAAA,EAAAC,EAAA,EAQA,IAAAC,EACA,MAAAC,EAAAC,GAAAC,EAAA,sBACE,IAAAC,EAAA,MAAA,OAAA,gBAAA,QAAA,sCAAA,CAA0F,kBAAA,GACrE,qBAAA,KACG,2BAAA,GACM,WAAA,EAChB,oCAAA,GACyB,aAAA,GACvB,uBAAA,EACU,CAAA,EAE1BF,EAAA,MAAA,WAAA,IAAAE,CAAA,EACAF,EAAA,OAAAE,CAAA,EACAF,EAAA,MAAA,MAAA,aAAA,QAAA,GAIA,IAAAG,EAAA,IACA,IAAAC,EAAA,OAAA,aAAA,cAAAF,EAAA,eAAA,MAAA,EACAG,EAAA,OAAA,WAAA,YAAgCD,EAAA,UACjBA,EAAA,SACAA,EAAA,MACA,EAEfE,EAAA,OAAA,WAAA,YAA+BF,EAAA,UAChBA,EAAA,SACAA,EAAA,OAAAD,CACS,EAExBI,EAAA,OAAA,WAAA,SAAAD,EAAAD,EAAA,IAAA,OAAA,UAAA,EACAH,EAAA,YAAA,OAAA,QAAA,gBAAAK,CAAA,EAEA,IAAAC,EAAA,IAAAC,EAAA,GAAAC,EAAA,GAGAZ,EAAA,IAAAa,EAAAX,CAAA,EACAF,EAAA,oBAAA,CAA+B,OAAA,EACrB,SAAA,CAAAc,EAAAC,IAAA,CAEN,GAAAb,EAAA,MAAA,MAAA,wBACE,aAAA,SAAA,EACA,GAEFa,IACEA,EAAA,QAAA,kBAAA,GACAA,EAAA,QAAA,eAAA,IAAA,OAAA,iBAAA,KACEH,EAAAA,EAAAD,EACAC,EAAAF,IACEE,EAAAF,GAEFE,GAAO,EAAA,EAETG,EAAA,QAAA,SAAA,6BACF,CACF,CAAA,CACD,GAGHC,EAAA,IAAA,CACEhB,EAAA,UAAA,SAAA,WAAwC"}