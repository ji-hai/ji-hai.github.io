import{_ as O}from"./ContentWrap.vue_vue_type_script_setup_true_lang-cstENLkZ.js";import{_ as T,u as I}from"./useCesium-2Loz9dXe.js";import{l as V,z as W,m as D,S as R,R as E,q as F,O as k,u as A}from"./vue-chunks-DuYwYYUM.js";import"./index-D2Lqo6FR.js";import"./element-plus-t0Lc7SBq.js";/* empty css                  *//*!
 * author: joe <qj5657@gmail.com>
 * cesium-wind 1.0.3
 * build-time: 2020-9-23 11:17
 * LICENSE: MIT
 * (c) 2020-2020 https://github.com/QJvic/cesium-wind
 *//*!
 * author: sakitam-fdd <smilefdd@gmail.com> 
 * wind-core v1.0.0-alpha.9
 * build-time: 2020-7-5 23:35
 * LICENSE: MIT
 * (c) 2017-2020 https://github.com/sakitam-fdd/wind-layer#readme
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function X(){for(var e=arguments,t=0,i=0,n=arguments.length;i<n;i++)t+=e[i].length;for(var s=Array(t),r=0,i=0;i<n;i++)for(var o=arguments[i],a=0,h=o.length;a<h;a++,r++)s[r]=o[a];return s}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"});typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(t,i){var n=arguments;if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(t),r=1;r<arguments.length;r++){var o=n[r];if(o!=null)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(s[a]=o[a])}return s},writable:!0,configurable:!0});var N=Object.prototype.hasOwnProperty,m=typeof Symbol!="undefined"?Symbol.toStringTag:void 0;function Y(e){if(e===null)return e===void 0?"[object Undefined]":"[object Null]";if(!(m&&m in Object(e)))return toString.call(e);var t=N.call(e,m),i=e[m],n=!1;try{e[m]=void 0,n=!0}catch(r){}var s=Object.prototype.toString.call(e);return n&&(t?e[m]=i:delete e[m]),s}function g(e){if(!L(e))return!1;var t=Y(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function L(e){var t=typeof e;return e!==null&&(t==="object"||t==="function")}function B(e){return e==null?!1:typeof e=="string"||e.constructor!==null&&e.constructor===String}function b(e){return Object.prototype.toString.call(e)==="[object Number]"&&!isNaN(e)}function G(e){return Array.isArray(e)}function z(e){for(var t=arguments,i=[],n=1;n<arguments.length;n++)i[n-1]=t[n];return Object.assign.apply(Object,X([e],i))}function q(e,t){return e-t*Math.floor(e/t)}function d(e){return e!=null&&!isNaN(e)}function $(e){var t,i;if(console.time("format-data"),e.forEach(function(r){switch(r.header.parameterCategory+","+r.header.parameterNumber){case"1,2":case"2,2":t=r;break;case"1,3":case"2,3":i=r;break}}),!(!i||!t)){var n=t.header,s=new P({xmin:n.lo1,ymin:n.la1,xmax:n.lo2,ymax:n.la2,deltaX:n.dx,deltaY:n.dy,cols:n.nx,rows:n.ny,us:t.data,vs:i.data});return console.timeEnd("format-data"),s}}function H(e){return e?(e.parentNode&&e.parentNode.removeChild(e),e):null}var S=function(){function e(t,i){this.u=t,this.v=i,this.m=this.magnitude()}return e.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},e.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v),i=t*(180/Math.PI);return i<0&&(i+=360),i},e.prototype.directionFrom=function(){var t=this.directionTo();return(t+180)%360},e}(),P=function(){function e(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=t.ymin,this.ymax=t.ymax,this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaY<0&&this.ymin<this.ymax?console.warn("[wind-core]: The data is flipY"):(this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin)),this.isFields=!0;var i=Math.ceil((this.xmax-this.xmin)/t.deltaX),n=Math.ceil((this.ymax-this.ymin)/t.deltaY);(i!==this.cols||n!==this.rows)&&console.warn("[wind-core]: The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.wrappedX="wrappedX"in t?t.wrappedX:this.xmax>180,this.grid=this.buildGrid(),this.range=this.calculateRange()}return e.prototype.buildGrid=function(){for(var t=[],i=0,n=this,s=n.rows,r=n.cols,o=n.us,a=n.vs,h=0;h<s;h++){for(var l=[],c=0;c<r;c++,i++){var u=o[i],p=a[i],f=this.isValid(u)&&this.isValid(p);l[c]=f?new S(u,p):null}this.isContinuous&&l.push(l[0]),t[h]=l}return t},e.prototype.release=function(){this.grid=[]},e.prototype.extent=function(){return[this.xmin,this.ymin,this.xmax,this.ymax]},e.prototype.bilinearInterpolateVector=function(t,i,n,s,r,o){var a=1-t,h=1-i,l=a*h,c=t*h,u=a*i,p=t*i,f=n.u*l+s.u*c+r.u*u+o.u*p,v=n.v*l+s.v*c+r.v*u+o.v*p;return new S(f,v)},e.prototype.calculateRange=function(){if(!(!this.grid||!this.grid[0])){for(var t=this.grid.length,i=this.grid[0].length,n,s,r=0;r<t;r++)for(var o=0;o<i;o++){var a=this.grid[r][o];if(a!==null){var h=a.m||a.magnitude();n===void 0?n=h:s===void 0?(s=h,n=Math.min(n,s),s=Math.max(n,s)):(n=Math.min(h,n),s=Math.max(h,s))}}return[n,s]}},e.prototype.isValid=function(t){return t!=null},e.prototype.getWrappedLongitudes=function(){var t=this.xmin,i=this.xmax;return this.wrappedX&&(this.isContinuous?(t=-180,i=180):(i=this.xmax-360,t=this.xmin-360)),[t,i]},e.prototype.contains=function(t,i){var n=this.getWrappedLongitudes(),s=n[0],r=n[1],o=t>=s&&t<=r,a;return this.deltaY>=0?a=i>=this.ymin&&i<=this.ymax:a=i>=this.ymax&&i<=this.ymin,o&&a},e.prototype.getDecimalIndexes=function(t,i){var n=q(t-this.xmin,360)/this.deltaX,s=(this.ymax-i)/this.deltaY;return[n,s]},e.prototype.valueAt=function(t,i){if(!this.contains(t,i))return null;var n=this.getDecimalIndexes(t,i),s=Math.floor(n[0]),r=Math.floor(n[1]),o=this.clampColumnIndex(s),a=this.clampRowIndex(r);return this.valueAtIndexes(o,a)},e.prototype.interpolatedValueAt=function(t,i){if(!this.contains(t,i))return null;var n=this.getDecimalIndexes(t,i),s=n[0],r=n[1];return this.interpolatePoint(s,r)},e.prototype.hasValueAt=function(t,i){var n=this.valueAt(t,i);return n!==null},e.prototype.interpolatePoint=function(t,i){var n=this.getFourSurroundingIndexes(t,i),s=n[0],r=n[1],o=n[2],a=n[3],h=this.getFourSurroundingValues(s,r,o,a);if(h){var l=h[0],c=h[1],u=h[2],p=h[3];return this.bilinearInterpolateVector(t-s,i-o,l,c,u,p)}return null},e.prototype.clampColumnIndex=function(t){var i=t;t<0&&(i=0);var n=this.cols-1;return t>n&&(i=n),i},e.prototype.clampRowIndex=function(t){var i=t;t<0&&(i=0);var n=this.rows-1;return t>n&&(i=n),i},e.prototype.getFourSurroundingIndexes=function(t,i){var n=Math.floor(t),s=n+1;this.isContinuous&&s>=this.cols&&(s=0),s=this.clampColumnIndex(s);var r=this.clampRowIndex(Math.floor(i)),o=this.clampRowIndex(r+1);return[n,s,r,o]},e.prototype.getFourSurroundingValues=function(t,i,n,s){var r;if(r=this.grid[n]){var o=r[t],a=r[i];if(this.isValid(o)&&this.isValid(a)&&(r=this.grid[s])){var h=r[t],l=r[i];if(this.isValid(h)&&this.isValid(l))return[o,a,h,l]}}return null},e.prototype.valueAtIndexes=function(t,i){return this.grid[i][t]},e.prototype.lonLatAtIndexes=function(t,i){var n=this.longitudeAtX(t),s=this.latitudeAtY(i);return[n,s]},e.prototype.longitudeAtX=function(t){var i=this.deltaX/2,n=this.xmin+i+t*this.deltaX;return this.wrappedX&&(n=n>180?n-360:n),n},e.prototype.latitudeAtY=function(t){var i=this.deltaY/2;return this.ymax-i-t*this.deltaY},e.prototype.randomize=function(t,i,n,s){t===void 0&&(t={});var r=Math.random()*(i||this.cols)|0,o=Math.random()*(n||this.rows)|0,a=s([r,o]);return a!==null?(t.x=a[0],t.y=a[1]):(t.x=this.longitudeAtX(r),t.y=this.latitudeAtY(o)),t},e.prototype.checkFields=function(){return this.isFields},e.prototype.startBatchInterpolate=function(t,i,n){},e}(),M={globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:1/25,maxAge:90,paths:800,frameRate:20,useCoordsDraw:!0,gpet:!0};function j(e,t,i,n){return Math.max(0,Math.min(n.length-1,Math.round((e-t)/(i-t)*(n.length-1))))}var U=function(){function e(t,i,n){if(this.particles=[],this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(i),n&&this.updateData(n)}return e.prototype.setOptions=function(t){this.options=Object.assign({},M,t);var i=this.ctx.canvas,n=i.width,s=i.height;"particleAge"in t&&!("maxAge"in t)&&b(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&b(this.options.particleMultiplier)&&(this.options.paths=Math.round(n*s*this.options.particleMultiplier)),this.prerender()},e.prototype.getOptions=function(){return this.options},e.prototype.updateData=function(t){this.field=t,this.generated&&(this.particles=this.prepareParticlePaths())},e.prototype.moveParticles=function(){for(var t=this.ctx.canvas,i=t.width,n=t.height,s=this.particles,r=this.options.maxAge,o=g(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale,a=o,h=0,l=s.length;h<l;h++){var c=s[h];c.age>r&&(c.age=0,this.field.randomize(c,i,n,this.unproject));var u=c.x,p=c.y,f=this.field.interpolatedValueAt(u,p);if(f===null)c.age=r;else{var v=u+f.u*a,w=p+f.v*a;this.field.hasValueAt(v,w)?(c.xt=v,c.yt=w,c.m=f.m):(c.x=v,c.y=w,c.age=r)}c.age++}},e.prototype.fadeIn=function(){var t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t},e.prototype.drawParticles=function(){var t,i=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle="rgba(0, 0, 0, "+this.options.globalAlpha+")",this.ctx.lineWidth=b(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=B(this.options.colorScale)?this.options.colorScale:"#fff";var n=0,s=i.length;if(this.field&&s>0){var r=void 0,o=void 0;for(d(this.options.minVelocity)&&d(this.options.maxVelocity)?(r=this.options.minVelocity,o=this.options.maxVelocity):(t=this.field.range,r=t[0],o=t[1]);n<s;n++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](i[n],r,o)}},e.prototype.drawPixelParticle=function(t,i,n){var s=[t.x,t.y],r=[t.xt,t.yt];if(r&&s&&d(r[0])&&d(r[1])&&d(s[0])&&d(s[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(s[0],s[1]),this.ctx.lineTo(r[0],r[1]),g(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var o=j(t.m,i,n,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[o]}g(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}},e.prototype.drawCoordsParticle=function(t,i,n){var s=[t.x,t.y],r=[t.xt,t.yt];if(r&&s&&d(r[0])&&d(r[1])&&d(s[0])&&d(s[1])&&this.intersectsCoordinate(r)&&t.age<=this.options.maxAge){var o=this.project(s),a=this.project(r);if(o&&a){if(this.ctx.beginPath(),this.ctx.moveTo(o[0],o[1]),this.ctx.lineTo(a[0],a[1]),t.x=t.xt,t.y=t.yt,g(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){var h=j(t.m,i,n,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[h]}g(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}},e.prototype.prepareParticlePaths=function(){var t=this.ctx.canvas,i=t.width,n=t.height,s=typeof this.options.paths=="function"?this.options.paths(this):this.options.paths,r=[];if(!this.field)return[];"startBatchInterpolate"in this.field&&this.field.startBatchInterpolate(i,n,this.unproject);for(var o=0;o<s;o++)r.push(this.field.randomize({age:this.randomize()},i,n,this.unproject));return r},e.prototype.randomize=function(){return Math.floor(Math.random()*this.options.maxAge)},e.prototype.project=function(){throw new Error("project must be overriden")},e.prototype.unproject=function(){throw new Error("unproject must be overriden")},e.prototype.intersectsCoordinate=function(t){throw new Error("must be overriden")},e.prototype.clearCanvas=function(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1},e.prototype.start=function(){this.starting=!0,this.forceStop=!1,this._then=Date.now(),this.animate()},e.prototype.stop=function(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0},e.prototype.animate=function(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);var t=Date.now(),i=t-this._then;i>this.options.frameRate&&(this._then=t-i%this.options.frameRate,this.render())},e.prototype.prerender=function(){this.generated=!1,this.field&&(this.particles=this.prepareParticlePaths(),this.generated=!0,!this.starting&&!this.forceStop&&(this.starting=!0,this._then=Date.now(),this.animate()))},e.prototype.render=function(){this.moveParticles(),this.drawParticles(),this.postrender()},e.prototype.postrender=function(){},e.Field=P,e}();class J{constructor(t,i={}){this.canvas=null,this.wind=null,this.field=null,this.viewer=null,this.options=z({},i),this.pickWindOptions();const n=document.createElement("canvas");n.style.cssText="position:absolute; left:0; top:0;user-select:none;pointer-events: none;",n.className="cesium-wind-j",this.canvas=n,t&&this.setData(t)}addTo(t){this.viewer=t,this.appendCanvas(),this.render(this.canvas)}remove(){this.viewer&&(this.wind&&this.wind.stop(),this.canvas&&H(this.canvas),delete this.canvas)}removeLayer(){this.remove()}setData(t){return t&&t.checkFields&&t.checkFields()?this.field=t:G(t)?this.field=$(t):console.error("Illegal data"),this.viewer&&this.canvas&&this.field&&(this.wind.updateData(this.field),this.appendCanvas(),this.render(this.canvas)),this}getData(){return this.field}getWindOptions(){return this.options.windOptions||{}}pickWindOptions(){Object.keys(M).forEach(t=>{t in this.options&&(this.options.windOptions===void 0&&(this.options.windOptions={}),this.options.windOptions[t]=this.options[t])})}getContext(){if(this.canvas!==null)return this.canvas.getContext("2d")}appendCanvas(){if(!this.viewer||!this.canvas||document.querySelector(".cesium-wind-j"))return;this.adjustSize(),this.viewer.canvas.parentNode.appendChild(this.canvas)}adjustSize(){const t=this.viewer,i=this.canvas,{width:n,height:s}=t.canvas,r=1;i.width=n*r,i.height=s*r,i.style.width=n+"px",i.style.height=s+"px"}render(t){if(!this.getData()||!this.viewer)return this;const i=this.getWindOptions();if(t&&!this.wind){const n=this.getData(),s=this.getContext();s&&(this.wind=new U(s,i,n),this.wind.project=this.project.bind(this),this.wind.unproject=this.unproject.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=()=>{})}return this.wind&&(this.wind.prerender(),this.wind.render()),this}project(t){const i=Cesium.Cartesian3.fromDegrees(t[0],t[1]),n=this.viewer.scene,s=Cesium.SceneTransforms.wgs84ToWindowCoordinates(n,i);return[s.x,s.y]}unproject(t){const i=this.viewer,n=new Cesium.Cartesian2(t[0],t[1]),s=i.scene.globe.pick(i.camera.getPickRay(n),i.scene);if(!s)return null;const o=i.scene.globe.ellipsoid.cartesianToCartographic(s),a=Cesium.Math.toDegrees(o.latitude);return[Cesium.Math.toDegrees(o.longitude),a]}intersectsCoordinate(t){const i=Cesium.Ellipsoid.WGS84,n=this.viewer.camera,s=new Cesium.EllipsoidalOccluder(i,n.position),r=Cesium.Cartesian3.fromDegrees(t[0],t[1]);return s.isPointVisible(r)}}const _=111e4,Q=function(e,t,i,n){var s=n/180*Math.PI,r=Math.sin(s),o=Math.cos(s);this.x=e,this.y=t,this.u=i*r/_,this.v=i*o/_,this.path=null},y=300,x=10,C=function(e,t,i){this._primitives=e.scene.primitives,this.data=t,this.forecastTime=i.forecastTime*60*60,this.currentTime=0,this.storms=null,this._init()};C.prototype={constructor:C,_init:function(){this._createField()},_createField:function(){var e=[];this.data.forEach(function(t){var i=new Q(t.x,t.y,t.speed,t.direction);i.path=[i.x,i.y,i.x+i.u*y*x,i.y+i.v*y*x],e.push(i)}),this.storms=e},animate:function(){var e=this;this._timer=setInterval(function(){e.updatePosition(),e.clearStorm(),e.updateStorm()},100)},stopAnimate:function(){this._timer&&clearInterval(this._timer),this._timer=null},resetPosition:function(){this.storms.forEach(function(e){e.path[0]=e.x,e.path[1]=e.y,e.path[2]=e.x+e.u*y*x,e.path[3]=e.y+e.v*y*x})},updatePosition:function(){if(this.currentTime>=this.forecastTime){this.resetPosition(),this.currentTime=0;return}this.currentTime+=y;var e=this;this.storms.forEach(function(t){var i=t.u*e.currentTime,n=t.v*e.currentTime;t.path[0]+=i,t.path[1]+=n,t.path[2]+=i,t.path[3]+=n})},updateStorm:function(){var e=[];this.storms.forEach(function(t){var i=new Cesium.PolylineGeometry({positions:Cesium.Cartesian3.fromDegreesArray(t.path),colors:[Cesium.Color.WHITE.withAlpha(0),Cesium.Color.WHITE],width:1.5,colorsPerVertex:!0});e.push(new Cesium.GeometryInstance({geometry:i}))}),this._polylines=this._primitives.add(new Cesium.Primitive({geometryInstances:e,appearance:new Cesium.PolylineColorAppearance({translucent:!0}),asynchronous:!1}))},clearStorm:function(){this._polylines&&this._primitives.remove(this._polylines)}};const Z={class:"w-[100%] h-[100%]"},rt=V({name:"CesiumWind",__name:"CesiumWind",setup(e){const{mapRegister:t}=I();let i,n;const s=r=>{r.camera.setView({destination:Cesium.Cartesian3.fromDegrees(120.84,30.15,1785e4*.01),orientation:{heading:Cesium.Math.toRadians(350.4202942851978),pitch:Cesium.Math.toRadians(-89.74026687972041),roll:Cesium.Math.toRadians(0)}});const o={colorScale:["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],frameRate:16,maxAge:60,globalAlpha:.9,velocityScale:1/30,paths:2e3};fetch("/public/data/uvwind_d01.json").then(h=>h.json()).then(h=>{i=new J(h,{windOptions:o}),i.addTo(r)});let a=[{x:120.3077,y:30.0539,speed:15,direction:269},{x:120.3177,y:30.0439,speed:15,direction:269}];n=new C(r,a,{forecastTime:2}),n.animate()};return W(()=>{i==null||i.remove(),n==null||n.stopAnimate(),n==null||n.clearStorm()}),(r,o)=>(D(),R(A(O),{title:"CesiumWind"},{default:E(()=>[F("div",Z,[k(T,{onRegister:A(t),config:{},tiandituTk:"80cd3c8ae46ae32fa0ac19f6d739d310",cesiumLoadCB:s},null,8,["onRegister"])])]),_:1}))}});export{rt as default};
//# sourceMappingURL=CesiumWind-RsXNb-uY.js.map
