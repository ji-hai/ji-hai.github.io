{"version":3,"file":"Screenshot-BTWS5GNF.js","sources":["../../src/views/SceneEffects/Screenshot.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { ContentWrap } from '@/components/ContentWrap'\r\nimport CesiumComponent from '@/components/Cesium/Cesium.component.vue'\r\n\r\nimport { useCesium } from '@/hooks/web/useCesium'\r\nimport * as Cesium from 'cesium'\r\n\r\nimport { ElButton } from 'element-plus'\r\n\r\nconst { mapRegister, mapMethods } = useCesium()\r\n\r\nconst { getMap } = mapMethods\r\n\r\ndefineOptions({\r\n  name: 'Screenshot'\r\n})\r\n\r\n/**\r\n * @description: 场景导出\r\n * @param {*} _viewer\r\n * @return {*}\r\n */\r\n\r\nconst saveToImage = (_viewer) => {\r\n  // 不写会导出为黑图\r\n  _viewer.render()\r\n\r\n  let canvas = _viewer.scene.canvas\r\n  let image = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream')\r\n\r\n  let link = document.createElement('a')\r\n  let blob = dataURLtoBlob(image)\r\n  let objurl = URL.createObjectURL(blob)\r\n  link.download = 'scene.png'\r\n  link.href = objurl\r\n  link.click()\r\n}\r\n\r\nconst dataURLtoBlob = (dataurl) => {\r\n  let arr = dataurl.split(','),\r\n    mime = arr[0].match(/:(.*?);/)[1],\r\n    bstr = atob(arr[1]),\r\n    n = bstr.length,\r\n    u8arr = new Uint8Array(n)\r\n  while (n--) {\r\n    u8arr[n] = bstr.charCodeAt(n)\r\n  }\r\n  return new Blob([u8arr], {\r\n    type: mime\r\n  })\r\n}\r\n\r\nconst cesiumLoadCB = (viewer) => {\r\n  viewer.camera.setView({\r\n    destination: Cesium.Cartesian3.fromDegrees(120.84, 30.15, 5000),\r\n    orientation: {\r\n      heading: Cesium.Math.toRadians(350.4202942851978),\r\n      pitch: Cesium.Math.toRadians(-89.74026687972041),\r\n      roll: Cesium.Math.toRadians(0.1)\r\n    },\r\n    complete: () => {\r\n      // 定位完成之后的回调函数\r\n      // 聚合\r\n      // addCesiumCluster(earthquakes)\r\n    }\r\n  })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <ContentWrap title=\"场景截图\">\r\n    <ElButton class=\"mb-4\" type=\"primary\" @click=\"saveToImage(getMap())\">导出场景</ElButton>\r\n    <div class=\"w-[100%] h-[100%]\">\r\n      <cesium-component\r\n        @register=\"mapRegister\"\r\n        :config=\"{\r\n          // homeButton: true\r\n        }\"\r\n        tiandituTk=\"80cd3c8ae46ae32fa0ac19f6d739d310\"\r\n        :cesiumLoadCB=\"cesiumLoadCB\"\r\n      />\r\n    </div>\r\n  </ContentWrap>\r\n</template>\r\n"],"names":["mapRegister","mapMethods","useCesium","getMap","saveToImage","_viewer","image","link","blob","dataURLtoBlob","objurl","dataurl","arr","mime","bstr","n","u8arr","cesiumLoadCB","viewer"],"mappings":"saASA,KAAA,CAAA,YAAAA,EAAA,WAAAC,CAAA,EAAAC,EAAA,EAEA,CAAA,OAAAC,CAAA,EAAAF,EAYAG,EAAAC,GAAA,CAEEA,EAAA,OAAA,EAGA,IAAAC,EADAD,EAAA,MAAA,OACA,UAAA,WAAA,EAAA,QAAA,YAAA,oBAAA,EAEAE,EAAA,SAAA,cAAA,GAAA,EACAC,EAAAC,EAAAH,CAAA,EACAI,EAAA,IAAA,gBAAAF,CAAA,EACAD,EAAA,SAAA,YACAA,EAAA,KAAAG,EACAH,EAAA,MAAA,CAAW,EAGbE,EAAAE,GAAA,CACE,IAAAC,EAAAD,EAAA,MAAA,GAAA,EAAAE,EAAAD,EAAA,CAAA,EAAA,MAAA,SAAA,EAAA,CAAA,EAAAE,EAAA,KAAAF,EAAA,CAAA,CAAA,EAAAG,EAAAD,EAAA,OAAAE,EAAA,IAAA,WAAAD,CAAA,EAKA,KAAAA,KACEC,EAAAD,CAAA,EAAAD,EAAA,WAAAC,CAAA,EAEF,OAAA,IAAA,KAAA,CAAAC,CAAA,EAAA,CAAyB,KAAAH,CACjB,CAAA,CACP,EAGHI,EAAAC,GAAA,CACEA,EAAA,OAAA,QAAA,CAAsB,YAAA,OAAA,WAAA,YAAA,OAAA,MAAA,GAAA,EAC0C,YAAA,CACjD,QAAA,OAAA,KAAA,UAAA,iBAAA,EACqC,MAAA,OAAA,KAAA,UAAA,kBAAA,EACD,KAAA,OAAA,KAAA,UAAA,EAAA,CAChB,EACjC,SAAA,IAAA,CACgB,CAIhB,CAAA,CACD"}