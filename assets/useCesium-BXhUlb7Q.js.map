{"version":3,"file":"useCesium-BXhUlb7Q.js","sources":["../../src/components/Cesium/props.ts","../../src/components/Cesium/Cesium.component.vue","../../src/hooks/web/useCesium.ts"],"sourcesContent":["/**\r\n * @description cesium属性\r\n * @author jihai\r\n * @time 23/4/11\r\n *\r\n * */\r\nexport const cesiumProps = {\r\n\ttiandituTk: {\r\n\t\ttype: String,\r\n\t\trequired: true\r\n\t},\r\n\tconfig: {\r\n\t\ttype: Object,\r\n\t\tdefault: ()=>{}\r\n\t},\r\n\tcesiumLoadCB: {\r\n\t\ttype: Function,\r\n\t\tdefault: ()=> {\r\n\t\t}\r\n\t}\r\n}\r\n","<template>\r\n  <div id=\"cesiumContainer\" class=\"h-[100%] w-[100%]\"> </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\" name=\"Cesium.component\">\r\nimport { onMounted, markRaw, onBeforeUnmount } from 'vue'\r\nimport * as Cesium from 'cesium'\r\n\r\nimport { cesiumProps } from './props'\r\nimport { setEventHandler } from '@/components/Cesium/CesiumEventHandler'\r\nimport { vi } from '@faker-js/faker'\r\n\r\nconst emit = defineEmits(['register'])\r\n\r\nconst props = defineProps(cesiumProps)\r\n\r\nlet viewer\r\nonMounted(() => {\r\n  // 服务负载子域\r\n  const subdomains = ['0', '1', '2', '3', '4', '5', '6', '7']\r\n  // Cesium.Ion.defaultAccessToken = props.cesiumAsset;\r\n\r\n  viewer = new Cesium.Viewer(\r\n    'cesiumContainer',\r\n    Object.assign(\r\n      {\r\n        // 指定上下文\r\n        // 类型：Object，默认值：无，传递给场景（scene）的与options相对应的上下文和WebGL创建属性。\r\n        // 这个设置需要一些webGL相关知识，默认值是：\r\n        // { webgl : { alpha : false, depth : true,\r\n        // stencil : false, antialias : true,\r\n        // powerPreference: ‘high-performance’,\r\n        // premultipliedAlpha : true,\r\n        // preserveDrawingBuffer : false,\r\n        // failIfMajorPerformanceCaveat : false },\r\n        // allowTextureFilterAnisotropic : true }。\r\n        // 其中， webgl.alpha 默认是false，之所以跟webGL默认的false不一样是因为这样可以提升性能，如果应用程序需要在其他HTML元素之上使用alpha混合，\r\n        // 设置 webgl.alpha 为true。\r\n        // allowTextureFilterAnisotropic 默认设置为true，当支持WebGL扩展时启用各向异性纹理过滤。\r\n        // 将此设置为false会提高性能，但会损害视觉质量，尤其是对于地平线视图。其他用默认就好。\r\n        contextOptions: {\r\n          requestWebgl1: true\r\n        },\r\n        shouldAnimate: true,\r\n        //类型：Boolean，默认值：true，是否创建左下角动画（Anaimation）小部件，可以在此小部件中方便的操作动画播放/暂停，\r\n        // 修改动画播放倍率。如果设置为false，则不会创建动画小部件。\r\n        animation: true,\r\n        homeButton: false, //home键\r\n        geocoder: false, //地址编码\r\n        baseLayerPicker: false, //图层选择控件\r\n        timeline: true, //时间轴\r\n        fullscreenButton: false, //全屏显示\r\n        infoBox: false, //点击要素之后浮窗\r\n        sceneModePicker: true, //投影方式  三维/二维\r\n        // sceneMode: 3, // 初始场景模式 1 2D模式 2 2D循环模式 3 3D模式  Cesium.SceneMode\r\n        navigationInstructionsInitiallyVisible: false, //导航指令\r\n        navigationHelpButton: false, //帮助信息\r\n        selectionIndicator: false, // 选择\r\n        imageryProvider: new Cesium.WebMapTileServiceImageryProvider({\r\n          //影像标注\r\n          url:\r\n            'http://t{s}.tianditu.com/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img' +\r\n            '&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=' +\r\n            props.tiandituTk,\r\n          subdomains: subdomains,\r\n          layer: 'tdtCiaLayer',\r\n          style: 'default',\r\n          format: 'image/jpeg',\r\n          tileMatrixSetID: 'GoogleMapsCompatible',\r\n          show: true\r\n        })\r\n      },\r\n      props.config\r\n    )\r\n  )\r\n\r\n  viewer._cesiumWidget._creditContainer.style.display = 'none' // 隐藏cesium ion\r\n  // viewer.timeline.container.style.display = 'none'; // 隐藏时间线\r\n  // viewer.animation.container.style.visibility = 'hidden' // 隐藏动画控件\r\n\r\n  viewer.imageryLayers.addImageryProvider(\r\n    new Cesium.WebMapTileServiceImageryProvider({\r\n      //影像标注\r\n      url:\r\n        'http://t{s}.tianditu.com/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img' +\r\n        '&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk=' +\r\n        props.tiandituTk,\r\n      subdomains: subdomains,\r\n      layer: 'tdtCiaLayer',\r\n      style: 'default',\r\n      format: 'image/jpeg',\r\n      tileMatrixSetID: 'GoogleMapsCompatible',\r\n      show: true\r\n    })\r\n  )\r\n  viewer.imageryLayers.addImageryProvider(\r\n    new Cesium.WebMapTileServiceImageryProvider({\r\n      //影像底图\r\n      url:\r\n        'http://t{s}.tianditu.com/cia_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cia&tileMatrixSet=w' +\r\n        '&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default.jpg&tk=' +\r\n        props.tiandituTk,\r\n      subdomains: subdomains,\r\n      layer: 'tdtCiaLayer',\r\n      style: 'default',\r\n      format: 'image/jpeg',\r\n      tileMatrixSetID: 'GoogleMapsCompatible',\r\n      show: true\r\n    })\r\n  )\r\n  // 最小缩放高度（米）\r\n  // viewer.scene.screenSpaceCameraController.minimumZoomDistance = 600\r\n  // // 最大缩放高度（米）\r\n  // viewer.scene.screenSpaceCameraController.maximumZoomDistance = 100000000\r\n\r\n  // 地球球体透明\r\n  // viewer.scene.skyAtmosphere.show = false;\r\n  // viewer.scene.globe.showGroundAtmosphere = false;\r\n  // viewer.scene.globe.baseColor = Cesium.Color.TRANSPARENT;\r\n  // viewer.scene.globe.translucency.enabled = true;\r\n  // viewer.scene.globe.undergroundColor = undefined;\r\n\r\n  // Enable depth testing so things behind the terrain disappear.\r\n  // viewer.scene.globe.depthTestAgainstTerrain = true;\r\n\r\n  // viewer.terrainProvider = new Cesium.CesiumTerrainProvider({\r\n  //   url: 'https://data.marsgis.cn/terrain'\r\n  // })\r\n\r\n  // 北京时间\r\n  viewer.clock.currentTime = Cesium.JulianDate.addHours(\r\n    Cesium.JulianDate.now(new Date()),\r\n    8,\r\n    new Cesium.JulianDate()\r\n  )\r\n\r\n  // cesium去除双击trackedEntity\r\n  viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(\r\n    Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK\r\n  )\r\n\r\n  // 默认定位到中国\r\n  viewer.camera.setView({\r\n    destination: Cesium.Cartesian3.fromDegrees(116.435314, 40.960521, 50000000.0)\r\n  })\r\n\r\n  emit('register', viewer)\r\n  props.cesiumLoadCB(viewer)\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n  viewer.destroy()\r\n})\r\n</script>\r\n","import { nextTick, markRaw } from 'vue'\r\n\r\n// Map实例\r\nconst state = markRaw({\r\n  map: ''\r\n})\r\nexport const useCesium = () => {\r\n  const register = (map) => {\r\n    state.map = map\r\n  }\r\n\r\n  const getMap = () => {\r\n    if (!state.map) {\r\n      console.error('The mapRef is not registered. Please use the register method to register')\r\n    }\r\n    return state.map\r\n  }\r\n\r\n  const methods = {\r\n    getMap: () => {\r\n      return state.map\r\n    }\r\n  }\r\n\r\n  return {\r\n    mapRegister: register,\r\n    mapMethods: methods\r\n  }\r\n}\r\n"],"names":["cesiumProps","emit","__emit","props","__props","viewer","onMounted","subdomains","onBeforeUnmount","state","markRaw","useCesium","map"],"mappings":"4EAMO,MAAMA,EAAc,CAC1B,WAAY,CACX,KAAM,OACN,SAAU,EACX,EACA,OAAQ,CACP,KAAM,OACN,QAAS,IAAI,CAAC,CACf,EACA,aAAc,CACb,KAAM,SACN,QAAS,IAAK,CACd,CACD,CACD,iICRA,MAAAC,EAAAC,EAEAC,EAAAC,EAEA,IAAAC,EACA,OAAAC,EAAA,IAAA,CAEE,MAAAC,EAAA,CAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,GAAA,EAGAF,EAAA,IAAA,OAAA,OAAoB,kBAClB,OAAA,OACO,CACL,eAAA,CAekB,cAAA,EACC,EACjB,cAAA,GACe,UAAA,GAGJ,WAAA,GACC,SAAA,GACF,gBAAA,GACO,SAAA,GACP,iBAAA,GACQ,QAAA,GACT,gBAAA,GACQ,uCAAA,GAEuB,qBAAA,GAClB,mBAAA,GACF,gBAAA,IAAA,OAAA,iCAAA,CACyC,IAAA,sMAAAF,EAAA,WAKnD,WAAAI,EACR,MAAA,cACO,MAAA,UACA,OAAA,aACC,gBAAA,uBACS,KAAA,EACX,CAAA,CACP,EACHJ,EAAA,MACM,CACR,EAGFE,EAAA,cAAA,iBAAA,MAAA,QAAA,OAIAA,EAAA,cAAA,mBAAqB,IAAA,OAAA,iCAAA,CACyB,IAAA,sMAAAF,EAAA,WAKlC,WAAAI,EACR,MAAA,cACO,MAAA,UACA,OAAA,aACC,gBAAA,uBACS,KAAA,EACX,CAAA,CACP,EAEHF,EAAA,cAAA,mBAAqB,IAAA,OAAA,iCAAA,CACyB,IAAA,6LAAAF,EAAA,WAKlC,WAAAI,EACR,MAAA,cACO,MAAA,UACA,OAAA,aACC,gBAAA,uBACS,KAAA,EACX,CAAA,CACP,EAsBHF,EAAA,MAAA,YAAA,OAAA,WAAA,SAA6C,OAAA,WAAA,IAAA,IAAA,IAAA,EACX,EAChC,IAAA,OAAA,UACsB,EAIxBA,EAAA,aAAA,wBAAA,kBAA4C,OAAA,qBAAA,iBACd,EAI9BA,EAAA,OAAA,QAAA,CAAsB,YAAA,OAAA,WAAA,YAAA,WAAA,UAAA,GAAA,CACwD,CAAA,EAG9EJ,EAAA,WAAAI,CAAA,EACAF,EAAA,aAAAE,CAAA,CAAyB,CAAA,EAG3BG,EAAA,IAAA,CACEH,EAAA,QAAA,CAAe,CAAA,6BCpJXI,EAAQC,EAAQ,CACpB,IAAK,EACP,CAAC,EACYC,EAAY,KAkBhB,CACL,YAlBgBC,GAAQ,CACxBH,EAAM,IAAMG,CAAA,EAkBZ,WARc,CACd,OAAQ,IACCH,EAAM,GACf,CAKY"}