{"version":3,"file":"ModifyMap-De78XhCH.js","sources":["../../src/views/SceneEffects/ModifyMap.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { ContentWrap } from '@/components/ContentWrap'\r\nimport CesiumComponent from '@/components/Cesium/Cesium.component.vue'\r\n\r\nimport gui from '@/plugins/gui'\r\n\r\nimport { useCesium } from '@/hooks/web/useCesium'\r\nimport * as Cesium from 'cesium'\r\n\r\nimport {\r\n  CustomMaterial,\r\n  CustomMaterialWall,\r\n  DynamicWallMaterialProperty,\r\n  PolylineTrailLinkMaterialProperty\r\n} from '@/components/Cesium/CesiumMaterialProperty'\r\n\r\nconst { mapRegister, mapMethods } = useCesium()\r\n\r\nconst { getMap } = mapMethods\r\n\r\ndefineOptions({\r\n  name: 'ModifyMap'\r\n})\r\n\r\nconst modifyMap = (viewer, options) => {\r\n  const baseLayer = viewer.imageryLayers.get(0)\r\n  //以下几个参数根据实际情况修改,目前我是参照火星科技的参数,个人感觉效果还不错\r\n  baseLayer.brightness = options.brightness || 0.6\r\n  baseLayer.contrast = options.contrast || 1.8\r\n  baseLayer.gamma = options.gamma || 0.3\r\n  baseLayer.hue = options.hue || 1\r\n  baseLayer.saturation = options.saturation || 0\r\n  const baseFragShader = viewer.scene.globe._surfaceShaderSet.baseFragmentShaderSource.sources\r\n  for (let i = 0; i < baseFragShader.length; i++) {\r\n    const strS = 'color = czm_saturation(color, textureSaturation);\\n#endif\\n'\r\n    let strT = 'color = czm_saturation(color, textureSaturation);\\n#endif\\n'\r\n    if (options.invertColor) {\r\n      strT += `\r\n      color.r = 1.0 - color.r;\r\n      color.g = 1.0 - color.g;\r\n      color.b = 1.0 - color.b;\r\n      `\r\n    }\r\n    if (options.filterRGB.length > 0) {\r\n      strT += `\r\n      color.r = color.r * ${options.filterRGB[0]}.0/255.0;\r\n      color.g = color.g * ${options.filterRGB[1]}.0/255.0;\r\n      color.b = color.b * ${options.filterRGB[2]}.0/255.0;\r\n      `\r\n    }\r\n    baseFragShader[i] = baseFragShader[i].replace(strS, strT)\r\n  }\r\n}\r\n\r\nconst cesiumLoadCB = (viewer) => {\r\n  viewer.camera.setView({\r\n    destination: Cesium.Cartesian3.fromDegrees(120.84, 30.15, 5000),\r\n    orientation: {\r\n      heading: Cesium.Math.toRadians(350.4202942851978),\r\n      pitch: Cesium.Math.toRadians(-89.74026687972041),\r\n      roll: Cesium.Math.toRadians(0.1)\r\n    },\r\n    complete: () => {\r\n      // 定位完成之后的回调函数\r\n      // 聚合\r\n      // addCesiumCluster(earthquakes)\r\n    }\r\n  })\r\n  // gui\r\n  //   .addColor(\r\n  //     {\r\n  //       filterRGB: [7, 47, 109]\r\n  //     },\r\n  //     'filterRGB'\r\n  //   )\r\n  //   .onChange((val) => {\r\n  //     modifyMap(viewer, {\r\n  //       invertColor: false,\r\n  //       filterRGB: [parseInt(val[0]), parseInt(val[1]), parseInt(val[2])]\r\n  //     })\r\n  //   })\r\n\r\n  // gui\r\n  //   .add(\r\n  //     {\r\n  //       invertColor: false\r\n  //     },\r\n  //     'invertColor'\r\n  //   )\r\n  //   .onChange((val) => {\r\n  //     // modifyMap(viewer, {\r\n  //     //   invertColor: val,\r\n  //     //   filterRGB: [125,125,125]\r\n  //     // })\r\n  //   })\r\n\r\n  const subdomains = ['0', '1', '2', '3', '4', '5', '6', '7']\r\n  viewer.imageryLayers.addImageryProvider(\r\n    new Cesium.WebMapTileServiceImageryProvider({\r\n      //影像标注\r\n      url: 'http://t{s}.tianditu.gov.cn/vec_w/wmts?tk=80cd3c8ae46ae32fa0ac19f6d739d310',\r\n      subdomains: subdomains,\r\n      layer: 'vec',\r\n      style: 'default',\r\n      tileMatrixSetID: 'w',\r\n      format: 'tiles',\r\n      maximumLevel: 18\r\n    })\r\n  )\r\n  viewer.imageryLayers.addImageryProvider(\r\n    new Cesium.WebMapTileServiceImageryProvider({\r\n      //影像标注\r\n      url: 'http://t{s}.tianditu.gov.cn/cva_w/wmts?tk=80cd3c8ae46ae32fa0ac19f6d739d310',\r\n      subdomains: subdomains,\r\n      layer: 'cva',\r\n      style: 'default',\r\n      tileMatrixSetID: 'w',\r\n      format: 'tiles',\r\n      maximumLevel: 18\r\n    })\r\n  )\r\n\r\n  modifyMap(viewer, {\r\n    invertColor: true,\r\n    filterRGB: [60, 145, 172]\r\n  })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <ContentWrap title=\"反色滤镜\">\r\n    <div class=\"w-[100%] h-[100%]\">\r\n      <cesium-component\r\n        @register=\"mapRegister\"\r\n        :config=\"{\r\n          // homeButton: true\r\n        }\"\r\n        tiandituTk=\"80cd3c8ae46ae32fa0ac19f6d739d310\"\r\n        :cesiumLoadCB=\"cesiumLoadCB\"\r\n      />\r\n    </div>\r\n  </ContentWrap>\r\n</template>\r\n"],"names":["mapRegister","mapMethods","useCesium","modifyMap","viewer","options","baseLayer","baseFragShader","i","strS","strT","cesiumLoadCB","subdomains"],"mappings":"iZAgBA,KAAA,CAAA,YAAAA,EAAA,WAAAC,CAAA,EAAAC,EAAA,EAQAC,EAAA,CAAAC,EAAAC,IAAA,CACE,MAAAC,EAAAF,EAAA,cAAA,IAAA,CAAA,EAEAE,EAAA,WAAAD,EAAA,YAAA,GACAC,EAAA,SAAAD,EAAA,UAAA,IACAC,EAAA,MAAAD,EAAA,OAAA,GACAC,EAAA,IAAAD,EAAA,KAAA,EACAC,EAAA,WAAAD,EAAA,YAAA,EACA,MAAAE,EAAAH,EAAA,MAAA,MAAA,kBAAA,yBAAA,QACA,QAAAI,EAAA,EAAAA,EAAAD,EAAA,OAAAC,IAAA,CACE,MAAAC,EAAA;AAAA;AAAA,EACA,IAAAC,EAAA;AAAA;AAAA,EACAL,EAAA,cACEK,GAAA;AAAA;AAAA;AAAA;AAAA,SAMFL,EAAA,UAAA,OAAA,IACEK,GAAA;AAAA,4BAAQL,EAAA,UAAA,CAAA,CAAA;AAAA,4BACkCA,EAAA,UAAA,CAAA,CAAA;AAAA,4BACAA,EAAA,UAAA,CAAA,CAAA;AAAA,SAI5CE,EAAAC,CAAA,EAAAD,EAAAC,CAAA,EAAA,QAAAC,EAAAC,CAAA,CAAwD,CAC1D,EAGFC,EAAAP,GAAA,CACEA,EAAA,OAAA,QAAA,CAAsB,YAAA,OAAA,WAAA,YAAA,OAAA,MAAA,GAAA,EAC0C,YAAA,CACjD,QAAA,OAAA,KAAA,UAAA,iBAAA,EACqC,MAAA,OAAA,KAAA,UAAA,kBAAA,EACD,KAAA,OAAA,KAAA,UAAA,EAAA,CAChB,EACjC,SAAA,IAAA,CACgB,CAIhB,CAAA,EA8BF,MAAAQ,EAAA,CAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,GAAA,EACAR,EAAA,cAAA,mBAAqB,IAAA,OAAA,iCAAA,CACyB,IAAA,6EAErC,WAAAQ,EACL,MAAA,MACO,MAAA,UACA,gBAAA,IACU,OAAA,QACT,aAAA,EACM,CAAA,CACf,EAEHR,EAAA,cAAA,mBAAqB,IAAA,OAAA,iCAAA,CACyB,IAAA,6EAErC,WAAAQ,EACL,MAAA,MACO,MAAA,UACA,gBAAA,IACU,OAAA,QACT,aAAA,EACM,CAAA,CACf,EAGHT,EAAAC,EAAA,CAAkB,YAAA,GACH,UAAA,CAAA,GAAA,IAAA,GAAA,CACW,CAAA,CACzB"}