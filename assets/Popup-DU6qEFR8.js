import{_ as w}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BTMXJcO8.js";import{_ as y,u as v}from"./useCesium-HTMhJcaC.js";import{l as D,m as b,S as C,R as g,q as x,O as _,u as m}from"./vue-chunks-DuYwYYUM.js";import"./index-B05llsUP.js";import"./element-plus-t0Lc7SBq.js";/* empty css                  */class H{constructor(t,i){if(this.viewer=t,!this.viewer)return;this.type="prompt",i=i||{};const e=i.type==null?1:i.type,s={id:new Date().getTime()+""+Math.floor(Math.random()*1e4),type:e,anchor:e==2,closeBtn:e==2,offset:e==2?{x:42,y:90}:{x:40,y:90},content:"",show:!0,style:{background:"rgba(0,0,0,0.5)",color:"white"}};this.opt=Object.assign(s,i),this.attr=this.opt;const n=this.viewer.container.id;this.isShow=this.opt.show==null?!0:this.opt.show;let r="",p="";const a=this.opt.style.background,d=this.opt.style.color;this.opt.anchor&&(r+=`
            <div class="prompt-anchor-container">
                <div class="prompt-anchor" style="background:${a} !important;">
                </div>
            </div>
            `),this.opt.closeBtn&&(p=`<a class="prompt-close" attr="${this.opt.id}" id="prompt-close-${this.opt.id}">x</a>`);const f=this.opt.style.boxShadow,c="prompt-"+this.opt.id,u=`
                <!-- 文本内容 -->
                <div class="prompt-content-container" style="background:${a} !important;color:${d} !important;box-shadow:${f} !important">
                    <div class="prompt-content" id="prompt-content-${this.opt.id}">
                        ${this.opt.content}
                    </div>
                </div>
                <!-- 锚 -->
                ${r}
                <!-- 关闭按钮 -->
                ${p}
        `;this.promptDiv=window.document.createElement("div"),this.promptDiv.className=`lanwarf_cesium-prompt ${this.opt.className}`,this.promptDiv.id=c,this.promptDiv.innerHTML=u,window.document.getElementById(n).appendChild(this.promptDiv);const h=window.document.getElementById(`prompt-close-${this.opt.id}`),o=this;h&&h.addEventListener("click",T=>{o.hide(),o.opt.close&&o.opt.close()}),this.promptDom=window.document.getElementById(c),this.position=this.transPosition(this.opt.position),e==2&&this.bindRender(),this.opt.show==!1&&this.hide(),this.containerW=this.viewer.container.offsetWidth,this.containerH=this.viewer.container.offsetHeight,this.containerLeft=this.viewer.container.offsetLeft,this.containerTop=this.viewer.container.offsetTop,this.contentW=Math.ceil(Number(this.promptDom.offsetWidth)),this.contentH=this.promptDom.offsetHeight,this.opt.success&&this.opt.success()}destroy(){this.promptDiv&&(window.document.getElementById(this.viewer.container.id).removeChild(this.promptDiv),this.promptDiv=null),this.rendHandler&&(this.rendHandler(),this.rendHandler=null)}bindRender(){const t=this;this.rendHandler=this.viewer.scene.postRender.addEventListener(function(){if(!t.isShow&&t.promptDom){t.promptDom.style.display="none";return}if(t.position)if(t.position instanceof Cesium.Cartesian3){const i=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t.viewer.scene,t.position);if(!i)return;new Cesium.EllipsoidalOccluder(t.viewer.scene.globe.ellipsoid,t.viewer.scene.camera.position).isPointVisible(t.position)?t.promptDom&&(t.promptDom.style.display="block"):t.promptDom&&(t.promptDom.style.display="none"),t.setByPX({x:i.x,y:i.y})}else t.setByPX({x:t.position.x,y:t.position.y})},this)}update(t,i){t instanceof Cesium.Cartesian3&&(this.position=t.clone(),t=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,t)),this.contentW=Math.ceil(Number(this.promptDom.offsetWidth)),this.contentH=this.promptDom.offsetHeight,t&&this.setByPX(t),i&&this.setContent(i)}isInView(){if(!this.position)return!1;let t=null;this.position instanceof Cesium.Cartesian2?t=this.position:t=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position);const e=new Cesium.EllipsoidalOccluder(this.viewer.scene.globe.ellipsoid,this.viewer.scene.camera.position).isPointVisible(this.position);let s=!1;return t?(t.x>this.containerLeft&&t.x<this.containerLeft+this.containerW&&t.y>this.containerTop&&t.y<this.containerTop+this.containerH&&(s=!0),e&&s):s}setVisible(t){this.isInView(this.position)&&t?(this.isShow=!0,this.promptDom&&(this.promptDom.style.display="block")):(this.isShow=!1,this.promptDom&&(this.promptDom.style.display="none"))}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}setContent(t){const i=window.document.getElementById(`prompt-content-${this.opt.id}`);i.innerHTML=t}setByPX(t){t&&this.promptDom&&(this.promptDom.offsetWidth,this.promptDom.offsetHeight,this.opt.type==1?(this.promptDom.style.left=Number(t.x)+Number(this.opt.offset.x||0)+"px",this.promptDom.style.top=Number(t.y)+Number(this.opt.offset.y||0)+"px"):(this.promptDom.style.left=Number(t.x)+Number(this.opt.offset.x||0)-Number(this.contentW)/2+"px",this.promptDom.style.top=Number(t.y)+Number(this.opt.offset.y||0)-Number(this.contentH)+"px"))}transPosition(t){let i;return Array.isArray(t)?i=Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]||0).clone():t instanceof Cesium.Cartesian3?i=t.clone():i=t,i}}const B={class:"w-[100%] h-[100%]"},R=D({name:"Popup",__name:"Popup",setup(l){const{mapRegister:t,mapMethods:i}=v(),e=s=>{s.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(120.84,30.15,5e3),orientation:{heading:Cesium.Math.toRadians(350.4202942851978),pitch:Cesium.Math.toRadians(-89.74026687972041),roll:Cesium.Math.toRadians(.1)},complete:()=>{}}),new H(s,{type:2,content:'<div style="width: 100px;height: 100px;background: red;">222</div>',position:[120.84,30.15,0],close:function(){return!1}})};return(s,n)=>(b(),C(m(w),{title:"Popup"},{default:g(()=>[x("div",B,[_(y,{onRegister:m(t),config:{},tiandituTk:"80cd3c8ae46ae32fa0ac19f6d739d310",cesiumLoadCB:e},null,8,["onRegister"])])]),_:1}))}});export{R as default};
//# sourceMappingURL=Popup-DU6qEFR8.js.map
